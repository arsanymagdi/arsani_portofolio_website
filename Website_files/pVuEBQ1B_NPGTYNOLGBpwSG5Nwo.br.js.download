var TextToSpeechService;(function(n){function b(i,f,s,c,l,a){h=f;r=i;u=s;n.maximumCharacterSupport=c;e=l;o=a;t=_d.createElement("audio");a&&_d.body.appendChild(t)}function k(n){return n&&u&&u.indexOf(n)!=-1}function d(t,r,u,e,o,h,p){h===void 0&&(h=SpeechServiceHelper.emptyFunction);p===void 0&&(p=SpeechServiceHelper.emptyFunction);var w=g(o),k=transDom.input.langSelect.value,d=transDom.output.langSelect.value,b=w=="Input"?k:d;if((!t||!r||!o||!u||!e||i)&&(l(),o==f)){translatorTel.logEvent(TranslatorWebTelemetry.EventScope.Audio_Event,"Audio Pause",{ux_action:"Pause",audioSide:w});translationClientInst.log(v,s,w,"language",b);return}translationClientInst.log(y,s,w,"language",b);translatorTel.logEvent(TranslatorWebTelemetry.EventScope.Audio_Event,"Audio Play",{ux_action:"Play",audioSide:w});RichTranslateHelper.isEdgePDFTranslator&&(w=="Input"?RichTranslateHelper.postMessageToEdgePDFTranslatorParent(RichTranslateHelper.edgePDFTranslatorMessageId.ToolUsed,{ToolName:"ReadAloudInput"}):w=="Output"&&RichTranslateHelper.postMessageToEdgePDFTranslatorParent(RichTranslateHelper.edgePDFTranslatorMessageId.ToolUsed,{ToolName:"ReadAloudOutput"}));f=o;c=p;sj_evt.fire(RichTranslateHelper.stopSpeechListen);t.length>n.maximumCharacterSupport&&(t=t.slice(0,n.maximumCharacterSupport));SpeechServiceHelper.isTokenUsed?SpeechServiceHelper.validTokenpresent?a(t,r,u,e,SpeechServiceHelper.regionKey,SpeechServiceHelper.authToken,h,p):SpeechServiceHelper.fetchOrUpdateSpeechAuthTokenOnDemand(function(){a(t,r,u,e,SpeechServiceHelper.regionKey,SpeechServiceHelper.authToken,h,p)},function(){}):AbusePreventionHelper.isEndpointTokenValid()&&nt(t,r,u,e,h,p)}function l(n){(n===void 0&&(n=null),i&&(!n||n==f))&&(t.pause(),i=!1,t.src="",c(),t.onended=function(){})}function g(n){return n==transDom.input.playIcon?"Input":n==transDom.output.playIcon?"Output":n&&n.id&&n.id.includes("pplExTgtT")?n.id:"AlternateTranslations"}function a(n,u,f,s,c,l,a,v){a===void 0&&(a=SpeechServiceHelper.emptyFunction);v===void 0&&(v=SpeechServiceHelper.emptyFunction);var w="<speak version='1.0' xml:lang='".concat(u,"'><voice xml:lang='").concat(u,"' xml:gender='").concat(f,"' name='").concat(s,"'><prosody rate='").concat(e,"'>").concat(n,"<\/prosody><\/voice><\/speak>"),y=sj_gx();y.open("POST",RichTranslateHelper.stringFormat(r,c),!0);y.setRequestHeader("Content-Type",p);y.setRequestHeader("Authorization","Bearer "+l);y.setRequestHeader("X-MICROSOFT-OutputFormat",h);y.setRequestHeader("cache-control","no-cache");y.responseType="arraybuffer";y.onreadystatechange=function(){y.readyState===4&&y.status===200&&y.response&&(a(),i=!0,t.src="data:audio/mp3;base64,"+SpeechServiceHelper.arrayBufferToBase64(y.response),o||t.load(),t.play(),t.onended=function(){i=!1;v()},t.onerror=function(){i=!1;v()})};y.send(w)}function nt(n,u,f,s,h,c){h===void 0&&(h=SpeechServiceHelper.emptyFunction);c===void 0&&(c=SpeechServiceHelper.emptyFunction);var a="&ssml=<speak version='1.0' xml:lang='".concat(u,"'><voice xml:lang='").concat(u,"' xml:gender='").concat(f,"' name='").concat(s,"'><prosody rate='").concat(e,"'>").concat(n,"<\/prosody><\/voice><\/speak>"),v=a+AbusePreventionHelper.getEndpointAuthParams(),l=sj_gx();l.open("POST",RichTranslateHelper.getInstEndPointUrl(r,transDom.iid,w++),!0);l.setRequestHeader("Content-type","application/x-www-form-urlencoded");l.responseType="arraybuffer";l.onreadystatechange=function(){l.readyState===4&&l.status===200&&l.response&&(h(),i=!0,t.src="data:audio/mp3;base64,"+SpeechServiceHelper.arrayBufferToBase64(l.response),o||t.load(),t.play(),t.onended=function(){i=!1;c()},t.onerror=function(){i=!1;c()})};l.send(v)}var v="PauseAudio",y="PlayAudio",s="AudioSource",p="application/ssml+xml";n.maximumCharacterSupport=1e3;var i=!1,r,h,u,f,c=SpeechServiceHelper.emptyFunction,t,e,o,w=1;n.init=b;n.isAudioLanguageSupported=k;n.playOrStopAudio=d;n.resetAudioControl=l})(TextToSpeechService||(TextToSpeechService={}))